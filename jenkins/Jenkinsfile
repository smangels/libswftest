node { // <1>

	def server = Artifactory.server 'swf1'
	def uploadSpec = readFile 'artifactory.spec'

    stage('Build') { // <2>
        checkout scm // everything starts with beautiful source code
        sh 'rm -rf build'   // just to ensure that subsequent build step will fail
        try {
            sh 'mkdir build && cd build && cmake .. && cmake --build .'
        }
        finally {
            echo "Finishing build step"
        }
    }
    stage('Test') {
        sh 'ls build/src/libswftest.a'  // check whether library exists

    }
    stage('Deploy') {
        // upload artifacts to Artifactory using ID:"swf1"
        def buildInfoUpload = server.upload spec:uploadSpec

        // publish the build information
        server.publishBuildInfo buildInfoUpload

        println 'succesfully uploaded artifacts'
    }
}